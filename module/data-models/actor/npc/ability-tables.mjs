/** @import { NPCTier } from "../../../config/config.mjs" */

/**
 * Get the appropriate stat for an NPC at a given tier, APL, and trait bonus.
 *
 * @param {NPCAbility} ability
 * @param {NPCTier} tier
 * @param {number} level
 * @param {number} modifier 0-3 if Normal, 0-2 if Notorious, 0-1 if Boss, ignored if End Boss
 * @returns {number}
 */
export function getNPCAbility(ability, tier, level, modifier) {
  // Get the table for the appropriate ability
  const tierTable = abilityTables[ability][tier];
  // If the modifier is too large for this tier, fall back to the highest one
  const abilityTable =
    modifier >= tierTable.length ? tierTable.lastItem : tierTable[modifier];

  return abilityTable[Math.clamp(level - 1, 0, 19)];
}

/** @type {Record<NPCTier, number[][]} */
const initiative = {
  normal: [
    [0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4, 4, 5, 5, 5, 6, 6, 6],
    [0, 1, 2, 2, 3, 3, 4, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 8, 9, 9],
    [1, 1, 2, 2, 3, 4, 4, 5, 5, 6, 7, 7, 8, 8, 9, 10, 10, 11, 11, 12],
    [1, 2, 3, 3, 4, 5, 6, 6, 7, 8, 9, 9, 10, 11, 12, 12, 13, 14, 15, 15],
  ],
  notorious: [
    [2, 3, 4, 5, 5, 6, 7, 8, 9, 9, 10, 10, 11, 12, 13, 14, 15, 15, 16, 17, 18],
    [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21],
    [3, 3, 4, 5, 6, 8, 9, 10, 11, 12, 13, 15, 16, 17, 18, 19, 20, 22, 23, 24],
  ],
  boss: [
    [3, 4, 6, 7, 8, 9, 11, 12, 13, 14, 16, 17, 18, 19, 21, 22, 23, 24, 26, 27],
    [4, 5, 6, 8, 9, 10, 12, 13, 15, 16, 18, 19, 20, 22, 23, 25, 26, 28, 29, 30],
  ],
  endBoss: [
    [
      4, 6, 7, 9, 10, 12, 13, 15, 16, 18, 19, 21, 22, 24, 25, 27, 28, 30, 31,
      33,
    ],
  ],
};

/** @type {Record<NPCTier, number[][]} */
const hpMp = {
  normal: [
    [
      5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95,
      100,
    ],
    [
      10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160,
      170, 180, 190, 200,
    ],
    [
      15, 30, 45, 60, 75, 90, 105, 120, 135, 150, 165, 180, 195, 210, 225, 240,
      255, 270, 285, 300,
    ],
    [
      20, 40, 60, 80, 100, 120, 140, 160, 180, 200, 220, 240, 260, 280, 300,
      320, 340, 360, 380, 400,
    ],
  ],
  notorious: [
    [
      25, 50, 75, 100, 125, 150, 175, 200, 225, 250, 275, 300, 325, 350, 375,
      400, 425, 450, 475, 500,
    ],
    [
      30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330, 360, 390, 420, 450,
      480, 510, 540, 570, 600,
    ],
    [
      35, 70, 105, 140, 175, 210, 245, 280, 315, 350, 385, 420, 455, 490, 525,
      560, 595, 630, 665, 700,
    ],
  ],
  boss: [
    [
      40, 80, 120, 160, 200, 240, 280, 320, 360, 400, 440, 480, 520, 560, 595,
      630, 665, 700,
    ],
    [
      45, 90, 135, 180, 225, 270, 315, 360, 405, 450, 495, 540, 585, 630, 675,
      720, 765, 810, 855, 900,
    ],
  ],
  endBoss: [
    [
      50, 100, 150, 200, 250, 300, 350, 400, 450, 500, 550, 600, 650, 700, 750,
      800, 850, 900, 950, 1000,
    ],
  ],
};

/** @type {Record<NPCTier, number[][]} */
const attack = {
  normal: [
    [0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10],
    [0, 1, 1, 2, 3, 3, 4, 5, 5, 6, 7, 7, 8, 9, 9, 10, 11, 11, 12, 12],
    [0, 1, 2, 3, 3, 4, 5, 6, 6, 7, 8, 9, 9, 10, 11, 12, 12, 13, 14, 15],
    [1, 2, 3, 4, 5, 5, 6, 7, 8, 9, 10, 10, 11, 12, 13, 14, 15, 15, 16, 17],
  ],
  notorious: [
    [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
    [1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22],
    [2, 3, 4, 5, 7, 8, 9, 10, 11, 13, 14, 15, 16, 17, 19, 20, 21, 22, 23, 25],
  ],
  boss: [
    [2, 3, 5, 6, 7, 9, 10, 11, 13, 14, 15, 17, 18, 19, 21, 22, 23, 25, 27, 27],
    [2, 3, 5, 6, 8, 9, 11, 12, 14, 16, 17, 18, 20, 21, 23, 24, 26, 27, 29, 30],
  ],
  endBoss: [
    [3, 5, 6, 8, 9, 11, 12, 14, 15, 17, 18, 20, 21, 23, 24, 26, 27, 29, 30, 32],
  ],
};

/** @type {Record<NPCTier, number[][]} */
const defense = {
  normal: [
    [
      10, 10, 11, 11, 11, 12, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 16,
      16, 16,
    ],
    [
      10, 11, 12, 12, 13, 13, 14, 14, 14, 15, 15, 16, 16, 17, 17, 18, 18, 18,
      19, 19,
    ],
    [
      11, 11, 12, 12, 13, 14, 14, 15, 15, 16, 17, 17, 18, 18, 19, 20, 20, 21,
      21, 22,
    ],
    [
      11, 12, 13, 13, 14, 15, 16, 16, 17, 18, 19, 19, 20, 21, 22, 22, 23, 24,
      25, 25,
    ],
  ],
  notorious: [
    [
      12, 13, 14, 15, 15, 16, 17, 18, 19, 20, 20, 21, 22, 23, 24, 25, 25, 26,
      27, 28,
    ],
    [
      12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29,
      30, 31,
    ],
    [
      13, 13, 14, 15, 16, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 32,
      33, 34,
    ],
  ],
  boss: [
    [
      13, 14, 16, 17, 18, 19, 21, 22, 23, 24, 26, 27, 28, 29, 31, 32, 33, 34,
      36, 37,
    ],
    [
      14, 15, 16, 18, 19, 20, 22, 23, 25, 26, 28, 29, 30, 32, 33, 35, 36, 38,
      39, 40,
    ],
  ],
  endBoss: [
    [
      14, 16, 17, 19, 20, 22, 23, 25, 26, 28, 29, 31, 32, 34, 35, 37, 38, 40,
      41, 43,
    ],
  ],
};

/** @type {Record<NPCTier, number[][]} */
const skillDefense = {
  normal: [
    [
      10, 10, 11, 11, 11, 12, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 16,
      16, 16,
    ],
    [
      10, 11, 11, 12, 12, 12, 13, 13, 14, 14, 14, 15, 15, 15, 16, 16, 17, 17,
      17, 18,
    ],
    [
      11, 12, 12, 12, 13, 13, 14, 14, 14, 15, 15, 16, 16, 16, 17, 17, 18, 18,
      18, 19,
    ],
    [
      11, 12, 12, 13, 13, 14, 14, 15, 15, 16, 16, 17, 17, 18, 18, 19, 19, 20,
      20, 21,
    ],
  ],
  notorious: [
    [
      12, 13, 13, 14, 14, 15, 15, 16, 16, 17, 17, 18, 18, 19, 19, 20, 20, 21,
      21, 22,
    ],
    [
      12, 13, 13, 14, 15, 15, 16, 16, 17, 17, 18, 19, 19, 20, 20, 21, 21, 22,
      23, 24,
    ],
    [
      13, 14, 14, 15, 16, 17, 17, 18, 18, 19, 20, 20, 21, 21, 22, 23, 23, 24,
      24, 25,
    ],
  ],
  boss: [
    [
      13, 14, 14, 15, 16, 17, 17, 18, 19, 20, 20, 21, 22, 23, 23, 24, 25, 26,
      26, 27,
    ],
    [
      14, 15, 16, 16, 17, 18, 19, 19, 20, 21, 22, 22, 23, 24, 25, 25, 26, 27,
      28, 28,
    ],
  ],
  endBoss: [
    [
      14, 15, 16, 17, 18, 18, 19, 20, 21, 22, 22, 23, 24, 25, 26, 26, 27, 28,
      29, 30,
    ],
  ],
};

/** @typedef {keyof typeof abilityTables} NPCAbility */
const abilityTables = {
  initiative,
  hpMp,
  attack,
  defense,
  skillDefense,
};
